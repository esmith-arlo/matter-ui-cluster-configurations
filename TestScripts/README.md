# Test Scripts

This directory contains scripts for testing and comparing capability generation results between Python and JavaScript implementations.

## Scripts

### 1. `generate_capabilities_js.js` (JavaScript)

Generates JSON capabilities from cluster XML file in the same format as the Python script.

**Usage:**
```bash
node TestScripts/generate_capabilities_js.js <xml_file> <output_json_file>
```

**Example:**
```bash
node TestScripts/generate_capabilities_js.js data/clusters/OnOff.xml output/onoff_js.json
```

### 2. `compare_capabilities.js`

Compares two JSON files generated by Python and JavaScript scripts.

**Usage:**
```bash
node TestScripts/compare_capabilities.js <python_json> <javascript_json> [output_diff_file]
```

**Example:**
```bash
node TestScripts/compare_capabilities.js output/onoff_python.json output/onoff_js.json output/diff.json
```

### 3. `run_comparison.sh`

Runs both generators (Python and JavaScript) for a single cluster and compares the results.

**Usage:**
```bash
./TestScripts/run_comparison.sh <cluster_xml_file>
```

**Example:**
```bash
./TestScripts/run_comparison.sh data/clusters/OnOff.xml
```

### 4. `run_all_comparisons.sh`

Runs comparisons for all clusters or clusters matching a pattern.

**Usage:**
```bash
./TestScripts/run_all_comparisons.sh [cluster_pattern]
```

**Examples:**
```bash
# All clusters
./TestScripts/run_all_comparisons.sh

# Only OnOff
./TestScripts/run_all_comparisons.sh OnOff

# Multiple clusters
./TestScripts/run_all_comparisons.sh "OnOff|LevelControl"
```

## Requirements

- Python 3.6+
- Node.js 14.0+
- npm (for installing dependencies)

## Installing Dependencies

Install dependencies for test scripts:

```bash
cd TestScripts
npm install
```

Or from project root:

```bash
cd TestScripts && npm install && cd ..
```

## Usage Examples

### Generating capabilities for a single cluster

```bash
# Python
python3 scripts/generate_matter_cluster_json.py data/clusters/OnOff.xml output/onoff_python.json

# JavaScript
node TestScripts/generate_capabilities_js.js data/clusters/OnOff.xml output/onoff_js.json

# Comparison
node TestScripts/compare_capabilities.js output/onoff_python.json output/onoff_js.json
```

### Automatic comparison

```bash
# Single cluster
./TestScripts/run_comparison.sh data/clusters/OnOff.xml

# All clusters
./TestScripts/run_all_comparisons.sh
```

## Output Format

Both generators create JSON files in the following format:

```json
{
  "id": "com.matter.cluster.onoff",
  "clusterId": "0x0006",
  "name": "On/Off",
  "schemaVersion": 1,
  "description": "Matter On/Off Cluster",
  "xmlSource": "data/clusters/OnOff.xml",
  "Capabilities": {
    "Attributes": {...},
    "Commands": {...},
    "Features": {...}
  }
}
```

## Test Results

Last test run results:
- **Total clusters**: 107
- **Passed**: 96 (89.7%)
- **Failed**: 11 (10.3%)

## Troubleshooting

### Error: Cannot find module '@xmldom/xmldom'

Install dependencies:
```bash
npm install
```

### Error: Permission denied

Make scripts executable:
```bash
chmod +x TestScripts/*.sh
chmod +x TestScripts/*.js
```

### Differences in results

If scripts generate different results:
1. Check the diff file for details
2. Ensure both scripts use the same version of the XML file
3. Check logs in `/tmp/comparison_*.log`
